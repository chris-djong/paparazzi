<!DOCTYPE airframe SYSTEM "../airframe.dtd">



  
  <!-- ************************************************
                DEFINITIONS
    ************************************************  -->
  <section name="INS" prefix="INS_">
    <define name="ROLL_NEUTRAL_DEFAULT" value="0" unit="deg"/>
    <define name="PITCH_NEUTRAL_DEFAULT" value="0" unit="deg"/>
  </section>

  <!-- ************************************************
               BATTERY DEFINITIONS
    ************************************************  -->
  <section name="BAT">
    <define name="MAX_BAT_LEVEL" value="12.5" unit="V"/> <!-- Max bat level only used to scale display in GCS -->
    <define name="LOW_BAT_LEVEL" value="10" unit="V"/> <!-- Used to display battery warning in GCS -->
    <define name="CATASTROPHIC_BAT_LEVEL" value="9.3" unit="V"/>  <!-- Warning: Kill mode is engaged in case this battery level is reached -->
    <define name="MilliAmpereOfAdc(_adc)" value="(_adc-632)*4.14"/>
  </section>

  <!-- ************************************************
               MISCELLANEOUS DEFINITIONS
    ************************************************  -->
  <section name="MISC">
    <define name="NOMINAL_AIRSPEED" value="12." unit="m/s"/>
    <define name="CARROT" value="5." unit="s"/>
    <define name="KILL_MODE_DISTANCE" value="(1.5*MAX_DIST_FROM_HOME)"/> <!-- Kill mode is engaged in case this distance is reached. -->
    <define name="DEFAULT_CIRCLE_RADIUS" value="80."/>

    <!--  <define name="UNLOCKED_HOME_MODE" value="TRUE"/>  This will unlock home mode and make it possible to fly outside of home in Auto1 and Manual / Not required!--> 
    <!-- <define name="RC_LOST_MODE" value="AP_MODE_AUTO2"/>  Go into AUTO2 in case RC is lost / if this variable is not set, HOME mode is triggered by default / Not required!-->

    <define name="APP_ANGLE" value="8" unit="deg"/>
  </section>

  <!-- ************************************************
               VERTICAL CONTROL DEFINITIONS
    ************************************************  -->
  <section name="VERTICAL CONTROL" prefix="V_CTL_">    
    <!-- New Control Algorithm 
    <define name="ALTITUDE_PGAIN" value="0.12"/>
    <define name="ALTITUDE_MAX_CLIMB" value="3"/>
    <define name="AUTO_CLIMB_LIMIT" value="2*V_CTL_ALTITUDE_MAX_CLIMB"/>
    <define name="PITCH_TRIM" value="2." unit="deg"/>

    <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.6"/>
    <define name="AUTO_THROTTLE_MIN_CRUISE_THROTTLE" value="0.25"/>
    <define name="AUTO_THROTTLE_MAX_CRUISE_THROTTLE" value="0.85"/>

    <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.088" unit="%/(m/s)"/>
    <define name="AUTO_THROTTLE_PGAIN" value="0.004"/>
    <define name="AUTO_THROTTLE_DGAIN" value="0.0"/>
    <define name="AUTO_THROTTLE_IGAIN" value="0."/>
    <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.11"/>

    <define name="AUTO_PITCH_PGAIN" value="0.027"/>
    <define name="AUTO_PITCH_DGAIN" value="0.01"/>
    <define name="AUTO_PITCH_IGAIN" value="0.0"/>
    <define name="AUTO_PITCH_MAX_PITCH" value="20" unit="deg"/>
    <define name="AUTO_PITCH_MIN_PITCH" value="-20" unit="deg"/>

    <define name="AUTO_AIRSPEED_SETPOINT" value="16."/>
    <define name="AUTO_AIRSPEED_THROTTLE_PGAIN" value="0.1"/>
    <define name="AUTO_AIRSPEED_THROTTLE_DGAIN" value="0.12"/>
    <define name="AUTO_AIRSPEED_THROTTLE_IGAIN" value="0.0"/>
    <define name="AUTO_AIRSPEED_PITCH_PGAIN" value="0.0"/>
    <define name="AUTO_AIRSPEED_PITCH_DGAIN" value="0.0"/>
    <define name="AUTO_AIRSPEED_PITCH_IGAIN" value="0.02"/>
    <define name="AIRSPEED_MAX" value="30"/>
    <define name="AIRSPEED_MIN" value="10"/>
    
    <define name="AUTO_GROUNDSPEED_SETPOINT" value="12"/>
    <define name="AUTO_GROUNDSPEED_PGAIN" value="15"/>
    <define name="AUTO_GROUNDSPEED_IGAIN" value="0.5"/>
    <define name="AUTO_GROUNDSPEED_DGAIN" value="5"/>

    <define name="PITCH_LOITER_TRIM" value="0." unit="deg"/>
    <define name="PITCH_DASH_TRIM" value="0." unit="deg"/>

    <define name="THROTTLE_SLEW" value="0.1"/> -->
     
    <!-- --------------------------------------------------------------------------- -->
    
    <!-- Energy Control Algorithm -->
    <define name="AUTO_AIRSPEED_SETPOINT" value="14.0"/>
    
    <define name="ALTITUDE_PGAIN" value="0.07"/>
    <define name="AIRSPEED_PGAIN" value="0.19"/>
    <define name="AUTO_THROTTLE_NOMINAL_CRUISE_THROTTLE" value="0.5"/>
    <define name="AUTO_THROTTLE_PITCH_OF_VZ_PGAIN" value="0.5"/>
    
    <define name="ALTITUDE_MAX_CLIMB" value="3.0"/>
    <define name="GLIDE_RATIO" value="7.0"/>
    
    <define name="AUTO_PITCH_OF_AIRSPEED_PGAIN" value="0.0"/>
    <define name="AUTO_PITCH_OF_AIRSPEED_IGAIN" value="0.0"/>
    <define name="AUTO_PITCH_OF_AIRSPEED_DGAIN" value="0.0"/>

    <define name="ENERGY_TOT_PGAIN" value="0.0"/>
    <define name="ENERGY_TOT_IGAIN" value="0.0"/>
    <define name="ENERGY_DIFF_PGAIN" value="0.0"/>
    <define name="ENERGY_DIFF_IGAIN" value="0.0"/>

    <define name="AUTO_THROTTLE_CLIMB_THROTTLE_INCREMENT" value="0.39" unit="%/(m/s)"/>
    
    <!-- <define name="AUTO_GROUNDSPEED_SETPOINT" value="0"/>
    <define name="AUTO_GROUNDSPEED_PGAIN" value="0.0"/>
     <define name="AUTO_GROUNDSPEED_IGAIN" value="0.00"/>
     <define name="AUTO_GROUNDSPEED_DGAIN" value="0.00"/> -->
    
    <define name="AUTO_THROTTLE_OF_AIRSPEED_PGAIN" value="0.12"/>
    <define name="AUTO_THROTTLE_OF_AIRSPEED_IGAIN" value="0.004"/> 
  </section>

  <!-- ************************************************
               HORIZONTAL CONTROL DEFINITIONS
    ************************************************  -->
  <section name="HORIZONTAL CONTROL" prefix="H_CTL_">
  <!--  These gains were taken from erik for energy? -->
  
     <define name="COURSE_PGAIN" value="0.5"/><!-- TODO: Tune values -->
     <define name="COURSE_DGAIN" value="0.2"/><!-- TODO: Tune values -->
     <define name="COURSE_TAU" value="0.5"/><!-- TODO: Tune values -->
     <!--
     The prebank is an adjustment to the roll setting which is performed when the aircraft is
     trying to do a circle and when it is close to the circumference of the circle. This way
     it does not fly straight into the circumference but instead it starts to make a roll as
     the one needed to fly in circles.
     There is a value in the airframe file COURSE_PRE_BANK_CORRECTION which can be used to
     increase o decrease the effect. If set to 1 then the normal prebank is done.
     If set to 0.5 then half of the additional roll is done. This causes the aircraft to not roll
     enough in order to fly the intended circle and it ends up flying in a larger circle.
     A value > 1 makes it fly a smaller circle.

    https://github.com/paparazzi/paparazzi/blob/master/sw/airborne/modules/nav.c#L132
    -->
    <define name="COURSE_PRE_BANK_CORRECTION" value="0.98"/>

    <define name="ROLL_MAX_SETPOINT" value="75" unit="deg"/>
    <define name="PITCH_MAX_SETPOINT" value="60" unit="deg"/>
    <define name="PITCH_MIN_SETPOINT" value="-60" unit="deg"/>

    <define name="PITCH_PGAIN" value="9000"/>
    <define name="PITCH_DGAIN" value="0"/>
    <define name="PITCH_IGAIN" value="30"/>
    <define name="PITCH_KFFA" value="10."/>
    <define name="PITCH_KFFD" value="0."/>

    <define name="ELEVATOR_OF_ROLL" value="500" unit="PPRZ_MAX"/>
    <define name="ROLL_SLEW" value="0.5"/><!-- TODO: Determine best value-->
    <define name="ROLL_ATTITUDE_GAIN" value="15000."/>
    <define name="ROLL_RATE_GAIN" value="972"/>
    <define name="ROLL_IGAIN" value="100."/>
    <define name="ROLL_KFFA" value="100"/>
    <define name="ROLL_KFFD" value="0"/>

    <!--<define name="PITCH_OF_ROLL" value="4." unit="deg"/>--><!-- TODO: : ?-->
    <define name="AILERON_OF_THROTTLE" value="0.0"/><!-- TODO: : ?-->
  
  
  
  <!-- These gains work for new control
    <define name="COURSE_PGAIN" value="0.743"/>
    <define name="COURSE_TAU" value="0.5"/>
    <define name="ROLL_MAX_SETPOINT" value="45." unit="deg"/>
    <define name="PITCH_MAX_SETPOINT" value="30." unit="deg"/>
    <define name="PITCH_MIN_SETPOINT" value="-30." unit="deg"/>
    <define name="COURSE_PRE_BANK_CORRECTION" value="1.0"/>

    <define name="ROLL_ATTITUDE_GAIN" vlue="11000."/>
    <define name="ROLL_RATE_GAIN" value="1000."/>
    <define name="ROLL_IGAIN" value="100."/>
    <define name="ROLL_KFFA" value="0"/>
    <define name="ROLL_KFFD" value="0"/>

    <define name="PITCH_PGAIN" value="10000"/>
    <define name="PITCH_DGAIN" value="500."/>
    <define name="PITCH_IGAIN" value="400"/>
    <define name="PITCH_KFFA" value="0."/>
    <define name="PITCH_KFFD" value="0."/>

    <define name="PITCH_OF_ROLL" value="1." unit="deg"/>
    <define name="AILERON_OF_THROTTLE" value="0.0"/>
    <define name="ELEVATOR_OF_ROLL" value="1400"/> -->
    
  </section>

  <!-- ************************************************
               NAVIGATIONAL DEFINITIONS
    ************************************************  -->
  <section name="NAV">
    <define name="NAV_GLIDE_PITCH_TRIM" value="0"/>
  </section>

  <!-- ************************************************
               FAILSAFE DEFINITIONS
    ************************************************  -->
  <!-- These are the definition are engaged in case a failsafe is triggered (like GPS lost for example) -->
  <section name="FAILSAFE" prefix="FAILSAFE_">
    <define name="DELAY_WITHOUT_GPS" value="2" unit="s"/>
    <define name="DEFAULT_THROTTLE" value="0.0" unit="%"/>
    <define name="DEFAULT_ROLL" value="0.3" unit="rad"/>
    <define name="DEFAULT_PITCH" value="0.0" unit="rad"/>
    <define name="HOME_RADIUS" value="100" unit="m"/>
  </section>

  <!-- ************************************************
               AGGRESSIVE DEFINITIONS
    ************************************************  -->
  <section name="AGGRESSIVE" prefix="AGR_">
    <define name="BLEND_START" value="50"/><!-- Altitude Error to Initiate Aggressive Climb CANNOT BE ZERO!!-->
    <define name="BLEND_END" value="15"/><!-- Altitude Error to Blend Aggressive to Regular Climb Modes  CANNOT BE ZERO!!-->
    <define name="CLIMB_THROTTLE" value="0.9"/><!-- Gaz for Aggressive Climb -->
    <define name="CLIMB_PITCH" value="0.35"/><!-- Pitch for Aggressive Climb -->
    <define name="DESCENT_THROTTLE" value="0.05"/><!-- Gaz for Aggressive Decent -->
    <define name="DESCENT_PITCH" value="-0.35"/><!-- Pitch for Aggressive Decent -->
    <define name="CLIMB_NAV_RATIO" value="0.8"/><!-- Percent Navigation for Altitude Error Equal to Start Altitude -->
    <define name="DESCENT_NAV_RATIO" value="1.0"/>
  </section>

  <!-- ************************************************
               SIMULATION DEFINITIONS
    ************************************************  -->
  <section name="SIMU">
    <define name="ROLL_RESPONSE_FACTOR" value="20"/>
    <define name="JSBSIM_MODEL" value="&quot;Malolo1&quot;"/>
    <!--define name="JSBSIM_INIT"	value="&quot;Malolo1-IC&quot;"/-->
    <define name="JSBSIM_LAUNCHSPEED" value="15.0"/>
    <define name="JSBSIM_IR_ROLL_NEUTRAL" value="RadOfDeg(0.)"/>
    <define name="JSBSIM_IR_PITCH_NEUTRAL" value="RadOfDeg(0.)"/>
  </section>

</airframe>
